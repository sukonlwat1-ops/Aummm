<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Solar Snakes: ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞ üöÄ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        body { font-family: 'Kanit', sans-serif; touch-action: manipulation; }
        .space-bg { background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%); overflow: hidden; position: relative; }
        .stars { background: transparent url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/1231630/stars.png') repeat top center; z-index: 0; position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.6; animation: move-twink-back 200s linear infinite; }
        @keyframes move-twink-back { from {background-position:0 0;} to {background-position:-10000px 5000px;} }
        
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 40px rgba(0, 0, 0, 0.8); }
        .glass-input { background: rgba(2, 6, 23, 0.6); border: 1px solid rgba(56, 189, 248, 0.3); transition: all 0.3s ease; color: white; }
        .glass-input:focus { background: rgba(2, 6, 23, 0.9); border-color: #38bdf8; box-shadow: 0 0 20px rgba(56, 189, 248, 0.4); }
        
        /* Rank Badges */
        .pilot-card { background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.4) 100%); border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden; }
        .rank-badge-legend { background: linear-gradient(135deg, #FFD700 0%, #B8860B 100%); color: #000; box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
        .rank-badge-guardian { background: linear-gradient(135deg, #d946ef 0%, #7e22ce 100%); color: #fff; box-shadow: 0 0 15px rgba(217, 70, 239, 0.6); }
        .rank-badge-astronaut { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: #fff; box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); }
        .rank-badge-tourist { background: linear-gradient(135deg, #22c55e 0%, #15803d 100%); color: #fff; }
        .rank-badge-dust { background: linear-gradient(135deg, #64748b 0%, #334155 100%); color: #cbd5e1; }
        .rank-row-1 { border-left: 3px solid #facc15; background: linear-gradient(90deg, rgba(250, 204, 21, 0.1), transparent); }
        .rank-row-2 { border-left: 3px solid #94a3b8; background: linear-gradient(90deg, rgba(148, 163, 184, 0.1), transparent); }
        .rank-row-3 { border-left: 3px solid #f97316; background: linear-gradient(90deg, rgba(249, 115, 22, 0.1), transparent); }

        .text-shadow-neon { text-shadow: 0 0 5px #38bdf8, 0 0 10px #38bdf8; }
        .text-shadow-red { text-shadow: 0 0 5px #f87171, 0 0 10px #ef4444; }

        /* 3D Dice */
        .scene { width: 100px; height: 100px; perspective: 400px; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transform: translateZ(-50px); transition: transform 1s; }
        .cube.show-1 { transform: translateZ(-50px) rotateY(0deg); }
        .cube.show-2 { transform: translateZ(-50px) rotateY(-90deg); }
        .cube.show-3 { transform: translateZ(-50px) rotateY(-180deg); }
        .cube.show-4 { transform: translateZ(-50px) rotateY(90deg); }
        .cube.show-5 { transform: translateZ(-50px) rotateX(-90deg); }
        .cube.show-6 { transform: translateZ(-50px) rotateX(90deg); }
        .cube__face { position: absolute; width: 100px; height: 100px; border: 2px solid rgba(147, 197, 253, 0.8); line-height: 100px; font-size: 40px; font-weight: bold; color: white; text-align: center; background: rgba(14, 165, 233, 0.8); box-shadow: 0 0 30px rgba(56, 189, 248, 0.8); border-radius: 12px; }
        .cube__face--1 { transform: rotateY(0deg) translateZ(50px); }
        .cube__face--2 { transform: rotateY(90deg) translateZ(50px); }
        .cube__face--3 { transform: rotateY(180deg) translateZ(50px); }
        .cube__face--4 { transform: rotateY(-90deg) translateZ(50px); }
        .cube__face--5 { transform: rotateX(90deg) translateZ(50px); }
        .cube__face--6 { transform: rotateX(-90deg) translateZ(50px); }
        .animate-spin-dice { animation: spinDice 0.2s infinite linear; }
        @keyframes spinDice { 0% { transform: rotateX(0) rotateY(0); } 100% { transform: rotateX(360deg) rotateY(360deg); } }

        /* Utilities */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .chat-bubble { max-width: 80%; padding: 8px 12px; border-radius: 16px; font-size: 0.85rem; margin-bottom: 6px; word-wrap: break-word; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .chat-mine { background: linear-gradient(90deg, #dc2626, #ea580c); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-theirs { background: #334155; color: #e2e8f0; align-self: flex-start; border-bottom-left-radius: 2px; }
        
        /* Announcement Effects */
        .announce-overlay { position: fixed; inset: 0; z-index: 100; pointer-events: none; display: flex; align-items: center; justify-content: center; }
        .announce-box { background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); padding: 2rem 3rem; border-radius: 2rem; border: 2px solid; transform: scale(0); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); text-align: center; box-shadow: 0 0 50px currentColor; }
        .announce-box.active { transform: scale(1); }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.5); } 70% { transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes shakeHard { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) rotate(-5deg); } 20%, 40%, 60%, 80% { transform: translateX(10px) rotate(5deg); } }
        
        .announce-modal { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .announce-shake { animation: shakeHard 0.5s ease-in-out; }
        .timer-warning { animation: pulseRed 1s infinite; color: #ef4444; text-shadow: 0 0 10px red; }
        @keyframes pulseRed { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        .animate-spin-slow { animation: spin 8s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, serverTimestamp, collection, addDoc, getDocs, orderBy, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const EMAIL_SERVICE_ID = "service_pz426ha"; 
        const EMAIL_TEMPLATE_ID = "template_1efzi9h";
        const EMAIL_PUBLIC_KEY = "TtSj1XQ5fLPnjYjpr";
        try { if (window.emailjs) window.emailjs.init(EMAIL_PUBLIC_KEY); } catch(e) { console.error(e); }

        const firebaseConfig = {
            apiKey: "AIzaSyB1OQteZ7lo4N2wiFLVGULea152pUk1kp4",
            authDomain: "myspacegame-6b940.firebaseapp.com",
            projectId: "myspacegame-6b940",
            storageBucket: "myspacegame-6b940.firebasestorage.app",
            messagingSenderId: "67671889390",
            appId: "1:67671889390:web:580f7459c792a88b10eaff",
            measurementId: "G-ZKLW04NJ6Q"
        };
        const GAME_APP_ID = 'space_adventure_v2';
        const GRID_SIZE = 6;
        const MAX_PLAYERS = 4;
        const SOLO_TIME_LIMIT = 7 * 60 * 1000;

        const SFX_URLS = {
            bgm: 'https://assets.mixkit.co/music/preview/mixkit-space-game-668.mp3',
            dice: 'https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3',
            step: 'https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-click-900.mp3',
            correct: 'https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3',
            wrong: 'https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3',
            warp: 'https://assets.mixkit.co/sfx/preview/mixkit-scifi-player-movement-transition-3148.mp3',
            fall: 'https://assets.mixkit.co/sfx/preview/mixkit-failure-arcade-alert-notification-2403.mp3',
            win: 'https://assets.mixkit.co/sfx/preview/mixkit-video-game-win-2016.mp3',
            pop: 'https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3',
            login: 'https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-confirmation-914.mp3',
            error: 'https://assets.mixkit.co/sfx/preview/mixkit-click-error-1110.mp3',
            msg: 'https://assets.mixkit.co/sfx/preview/mixkit-interface-hint-notification-911.mp3',
            timeout: 'https://assets.mixkit.co/sfx/preview/mixkit-system-beep-buzzer-fail-2964.mp3',
            glitch: 'https://assets.mixkit.co/sfx/preview/mixkit-short-glitch-error-2967.mp3'
        };

        const SFX = {};
        let audioUnlocked = false;

        window.unlockAudioSystem = () => {
            if(audioUnlocked) return;
            Object.keys(SFX_URLS).forEach(key => {
                SFX[key] = new Audio(SFX_URLS[key]);
                SFX[key].volume = key === 'bgm' ? 0.2 : 0.5;
            });
            SFX.bgm.loop = true;
            const silent = new Audio(SFX_URLS.pop);
            silent.muted = true;
            silent.play().then(() => { 
                audioUnlocked = true; 
                SFX.bgm.play().catch(()=>{}); 
            }).catch(e => console.log("Audio Autoplay prevented"));
        };

        window.playSound = (name) => { if (SFX[name]) { SFX[name].currentTime = 0; SFX[name].play().catch(() => {}); } };
        window.toggleBGM = () => { if(SFX.bgm.paused) SFX.bgm.play(); else SFX.bgm.pause(); };

        let db, auth;
        try { const app = initializeApp(firebaseConfig); auth = getAuth(app); db = getFirestore(app); } catch (e) { console.error("Firebase Init Error:", e); }

        let myPlayerId = null, myPlayerName = null, currentRoomId = null, gameState = null, unsubscribe = null, unsubscribeChat = null;
        let selectedChar = 'üë®‚ÄçüöÄ', isProcessingAction = false;
        let timerInterval = null;

        const getHintsRef = () => collection(db, 'artifacts', GAME_APP_ID, 'public', 'data', 'player_hints');
        function generateUid(name, pass) { const rawId = name + "_" + pass; let hash = 0; for (let i = 0; i < rawId.length; i++) { hash = ((hash << 5) - hash) + rawId.charCodeAt(i); hash |= 0; } return "pilot_" + Math.abs(hash).toString(36); }
        function showFormError(elementId, msg) { const errDiv = document.getElementById(elementId); if(errDiv) { errDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${msg}`; errDiv.style.display = 'block'; setTimeout(() => { errDiv.style.display = 'none'; }, 4000); } else { alert(msg); } window.playSound('error'); }
        function showLoginError(msg) { showFormError('login-error-msg', msg); }
        function showRegError(msg) { showFormError('reg-error-msg', msg); }
        function clearLoginError() { ['login-error-msg', 'reg-error-msg'].forEach(id => { const el = document.getElementById(id); if(el) { el.style.display = 'none'; el.innerHTML = ''; } }); }

        window.doRegister = async () => { /* ... */ 
            if (!db) return showRegError("‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå");
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const pass = document.getElementById('reg-pass').value.trim();
            const confirm = document.getElementById('reg-confirm').value.trim();
            const btn = document.getElementById('btn-register-confirm');
            clearLoginError();
            if(!name || !pass || !confirm || !email) return showRegError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
            if(pass !== confirm) return showRegError("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ...'; btn.disabled = true;
            try {
                const docRef = doc(getHintsRef(), name);
                const snap = await getDoc(docRef);
                if(snap.exists()) { showRegError(`‡∏ä‡∏∑‡πà‡∏≠ "${name}" ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß`); btn.innerHTML = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£'; btn.disabled = false; return; }
                const uid = generateUid(name, pass);
                await setDoc(docRef, { email: email, password: pass, uid: uid, createdAt: serverTimestamp() });
                await performLogin(name, uid);
            } catch(e) { console.error("Register Error:", e); showRegError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message); btn.innerHTML = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£'; btn.disabled = false; }
        };
        window.doLogin = async () => { /* ... */ 
            if (!db) return showLoginError("‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå");
            const name = document.getElementById('login-name').value.trim();
            const pass = document.getElementById('login-pass').value.trim();
            const btn = document.getElementById('btn-login-confirm');
            clearLoginError();
            if(!name || !pass) return showLoginError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...'; btn.disabled = true;
            try {
                const docRef = doc(getHintsRef(), name);
                const snap = await getDoc(docRef);
                if(!snap.exists()) { window.playSound('wrong'); if(confirm("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) { showRegisterMode(); document.getElementById('reg-name').value = name; } else { showLoginError("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"); } btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'; btn.disabled = false; return; }
                const userData = snap.data();
                const inputUid = generateUid(name, pass);
                if ((userData.password !== pass) && (userData.uid !== inputUid)) { showLoginError("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'; btn.disabled = false; return; }
                await performLogin(name, inputUid);
            } catch(e) { console.error(e); showLoginError("Error: " + e.message); btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'; btn.disabled = false; }
        };

        async function performLogin(name, uid) {
            try { myPlayerId = uid; myPlayerName = name; localStorage.setItem('sa_username', name); window.playSound('login'); document.getElementById('login-screen').style.display = 'none'; document.getElementById('lobby-screen').style.display = 'flex'; fetchPlayerStats(name, myPlayerId); } catch(e) { console.error(e); alert("Login Error"); }
        }

        window.logout = () => { if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) { localStorage.removeItem('sa_username'); window.location.reload(); } };
        window.openForgotPass=()=>{ document.getElementById('forgot-modal').style.display='flex'; document.getElementById('forgot-step-1').style.display='block'; document.getElementById('forgot-step-2').style.display='none'; const n=document.getElementById('login-name').value.trim(); if(n)document.getElementById('forgot-name').value=n; }; 
        window.closeForgotPass=()=>{document.getElementById('forgot-modal').style.display='none';};
        window.sendResetOTP = async () => { /* ... */ };
        window.confirmResetPassword = async () => { /* ... */ };

        window.showAuthMenu = () => { document.getElementById('auth-menu').style.display = 'flex'; document.getElementById('login-form').style.display = 'none'; document.getElementById('register-form').style.display = 'none'; document.getElementById('auth-title').innerText = "Solar Snakes"; clearLoginError(); };
        window.showLoginMode = () => { document.getElementById('auth-menu').style.display = 'none'; document.getElementById('login-form').style.display = 'block'; document.getElementById('register-form').style.display = 'none'; document.getElementById('auth-title').innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"; clearLoginError(); window.playSound('pop'); };
        window.showRegisterMode = () => { document.getElementById('auth-menu').style.display = 'none'; document.getElementById('login-form').style.display = 'none'; document.getElementById('register-form').style.display = 'block'; document.getElementById('auth-title').innerText = "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"; clearLoginError(); window.playSound('pop'); };
        window.gotoRegister = () => window.showRegisterMode(); window.gotoLogin = () => window.showLoginMode();
        window.enterGame = async () => {
            const btn = document.getElementById('enter-btn'); btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...'; btn.disabled = true;
            window.unlockAudioSystem(); window.playSound('pop'); 
            try { await signInAnonymously(auth); document.getElementById('loading-screen').style.display = 'none'; const savedName = localStorage.getItem('sa_username'); document.getElementById('login-screen').style.display = 'flex'; if (savedName) { document.getElementById('login-name').value = savedName; showLoginMode(); } else { showAuthMenu(); } } catch (e) { alert("Connect Error: " + e.message); btn.innerHTML = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'; btn.disabled = false; }
        };

        // --- EXPANDED QUESTIONS DATABASE (60 Questions) ---
        const QUESTIONS = [
            // Basics (Planets)
            {q:"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞‡∏Ñ‡∏∑‡∏≠?", a:["‡πÇ‡∏•‡∏Å","‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Ñ‡∏∑‡∏≠?", a:["‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ"], c:0},
            {q:"‡πÇ‡∏•‡∏Å‡∏°‡∏µ‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Å‡∏µ‡πà‡∏î‡∏ß‡∏á?", a:["1 ‡∏î‡∏ß‡∏á","2 ‡∏î‡∏ß‡∏á","‡πÑ‡∏°‡πà‡∏°‡∏µ"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÉ‡∏Å‡∏•‡πâ‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", a:["‡∏û‡∏∏‡∏ò","‡πÇ‡∏•‡∏Å","‡∏®‡∏∏‡∏Å‡∏£‡πå"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏ù‡∏≤‡πÅ‡∏ù‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å?", a:["‡∏û‡∏∏‡∏ò","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô‡∏™‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", a:["‡πÄ‡∏™‡∏≤‡∏£‡πå","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏¢‡∏π‡πÄ‡∏£‡∏ô‡∏±‡∏™"], c:0},
            {q:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏•‡∏±‡∏Å?", a:["‡∏û‡∏•‡∏π‡πÇ‡∏ï","‡∏à‡∏π‡∏õ‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå","‡πÄ‡∏ô‡∏õ‡∏à‡∏π‡∏ô"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", a:["‡∏û‡∏∏‡∏ò","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", a:["‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡πÄ‡∏™‡∏≤‡∏£‡πå","‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô?", a:["‡πÇ‡∏•‡∏Å","‡πÄ‡∏ô‡∏õ‡∏à‡∏π‡∏ô","‡∏¢‡∏π‡πÄ‡∏£‡∏ô‡∏±‡∏™"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 3 ‡∏Ñ‡∏∑‡∏≠?", a:["‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÇ‡∏•‡∏Å","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏ô‡∏ï‡∏∞‡πÅ‡∏Ñ‡∏á‡∏Ç‡πâ‡∏≤‡∏á?", a:["‡∏¢‡∏π‡πÄ‡∏£‡∏ô‡∏±‡∏™","‡πÄ‡∏™‡∏≤‡∏£‡πå","‡πÄ‡∏ô‡∏õ‡∏à‡∏π‡∏ô"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡πä‡∏≤‡∏ã‡∏¢‡∏±‡∏Å‡∏©‡πå‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏î‡∏ß‡∏á?", a:["2 ‡∏î‡∏ß‡∏á","4 ‡∏î‡∏ß‡∏á","8 ‡∏î‡∏ß‡∏á"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏ß‡∏á‡πÉ‡∏î‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå?", a:["‡∏û‡∏∏‡∏ò","‡πÇ‡∏•‡∏Å","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", a:["‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡πÇ‡∏•‡∏Å","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:0},
            
            // Moons & Satellites
            {q:"‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞?", a:["‡πÑ‡∏ó‡∏ó‡∏±‡∏ô","‡πÅ‡∏Å‡∏ô‡∏µ‡∏°‡∏µ‡∏î","‡πÑ‡∏≠‡πÇ‡∏≠"], c:1},
            {q:"‡πÑ‡∏ó‡∏ó‡∏±‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Ç‡∏≠‡∏á?", a:["‡∏î‡∏≤‡∏ß‡πÄ‡∏™‡∏≤‡∏£‡πå","‡∏î‡∏≤‡∏ß‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏î‡∏≤‡∏ß‡∏¢‡∏π‡πÄ‡∏£‡∏ô‡∏±‡∏™"], c:0},
            {q:"‡∏¢‡∏π‡πÇ‡∏£‡∏õ‡∏≤ ‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Ç‡∏≠‡∏á?", a:["‡∏î‡∏≤‡∏ß‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏î‡∏≤‡∏ß‡πÄ‡∏™‡∏≤‡∏£‡πå","‡∏î‡∏≤‡∏ß‡πÄ‡∏ô‡∏õ‡∏à‡∏π‡∏ô"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏î‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å?", a:["Sputnik 1","Explorer 1","Thaicom"], c:0},
            {q:"‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏≠‡∏ß‡∏Å‡∏≤‡∏®‡∏ô‡∏≤‡∏ô‡∏≤‡∏ä‡∏≤‡∏ï‡∏¥‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠?", a:["NASA","ISS","ESA"], c:1},
            
            // Physics & Space Science
            {q:"‡πÅ‡∏™‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ñ‡∏∂‡∏á‡πÇ‡∏•‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤?", a:["8 ‡∏ô‡∏≤‡∏ó‡∏µ","1 ‡∏õ‡∏µ","24 ‡∏ä‡∏°."], c:0},
            {q:"‡πÇ‡∏•‡∏Å‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤?", a:["1 ‡∏õ‡∏µ","1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô","1 ‡∏ß‡∏±‡∏ô"], c:2},
            {q:"‡∏õ‡∏µ‡πÅ‡∏™‡∏á ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏î‡∏Ç‡∏≠‡∏á?", a:["‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á","‡πÄ‡∏ß‡∏•‡∏≤","‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á"], c:0},
            {q:"‡∏´‡∏•‡∏∏‡∏°‡∏î‡∏≥‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡∏î‡∏≤‡∏ß‡∏§‡∏Å‡∏©‡πå‡∏ï‡∏≤‡∏¢","‡∏≠‡∏∏‡∏Å‡∏Å‡∏≤‡∏ö‡∏≤‡∏ï‡∏ä‡∏ô","‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î"], c:0},
            {q:"‡∏Å‡πä‡∏≤‡∏ã‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÇ‡∏•‡∏Å?", a:["‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô","‡πÑ‡∏ô‡πÇ‡∏ï‡∏£‡πÄ‡∏à‡∏ô","‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡∏Ø"], c:1},
            {q:"‡∏ô‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡πâ‡∏≥‡∏•‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏£‡∏á‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡πÅ‡∏£‡∏á‡∏•‡∏°","‡πÅ‡∏£‡∏á‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡∏ó‡∏∞‡πÄ‡∏•"], c:1},
            {q:"‡∏™‡∏™‡∏≤‡∏£‡∏°‡∏∑‡∏î (Dark Matter) ‡∏°‡∏µ‡∏Å‡∏µ‡πà %?", a:["~27%","~5%","~90%"], c:0},
            {q:"‡πÅ‡∏Å‡∏ô‡πÇ‡∏•‡∏Å‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏µ‡πà‡∏≠‡∏á‡∏®‡∏≤?", a:["23.5","45","90"], c:0},
            {q:"‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏î‡∏≤‡∏ß‡∏§‡∏Å‡∏©‡πå‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?", a:["‡πÅ‡∏î‡∏á","‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á","‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô"], c:2},
            {q:"‡πÄ‡∏ô‡∏ö‡∏¥‡∏ß‡∏•‡∏≤ ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡πä‡∏≤‡∏ã‡πÅ‡∏•‡∏∞‡∏ù‡∏∏‡πà‡∏ô","‡∏î‡∏≤‡∏ß‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î","‡∏´‡∏•‡∏∏‡∏°‡∏î‡∏≥"], c:0},

            // History & People
            {q:"‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡πà‡∏≠‡∏ß‡∏Å‡∏≤‡∏®?", a:["‡∏ô‡∏µ‡∏• ‡∏≠‡∏≤‡∏£‡πå‡∏°‡∏™‡∏ï‡∏£‡∏≠‡∏á","‡∏¢‡∏π‡∏£‡∏¥ ‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡∏¥‡∏ô","‡∏ö‡∏±‡∏ã ‡∏≠‡∏±‡∏•‡∏î‡∏£‡∏¥‡∏ô"], c:1},
            {q:"‡πÉ‡∏Ñ‡∏£‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏ö‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å?", a:["‡∏¢‡∏π‡∏£‡∏¥ ‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡∏¥‡∏ô","‡∏ô‡∏µ‡∏• ‡∏≠‡∏≤‡∏£‡πå‡∏°‡∏™‡∏ï‡∏£‡∏≠‡∏á","‡πÑ‡∏°‡πÄ‡∏Ñ‡∏¥‡∏• ‡∏Ñ‡∏≠‡∏•‡∏•‡∏¥‡∏ô‡∏™‡πå"], c:1},
            {q:"‡∏¢‡∏≤‡∏ô‡∏•‡∏≥‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á‡∏û‡∏•‡∏π‡πÇ‡∏ï?", a:["New Horizons","Voyager 2","Cassini"], c:0},
            {q:"‡∏¢‡∏≤‡∏ô‡∏•‡∏≥‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞?", a:["Voyager 1","Apollo 11","Curiosity"], c:0},
            {q:"‡∏û‡∏£‡∏∞‡∏ö‡∏¥‡∏î‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÑ‡∏ó‡∏¢?", a:["‡∏£.4","‡∏£.5","‡∏£.9"], c:0},
            {q:"‡πÉ‡∏Ñ‡∏£‡πÄ‡∏™‡∏ô‡∏≤‡∏ó‡∏§‡∏©‡∏é‡∏µ‡πÇ‡∏•‡∏Å‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏≠‡∏ö‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå?", a:["‡πÇ‡∏Ñ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏ô‡∏¥‡∏Ñ‡∏±‡∏™","‡∏Å‡∏≤‡∏•‡∏¥‡πÄ‡∏•‡πÇ‡∏≠","‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô"], c:0},

            // Fun Facts
            {q:"‡∏Å‡∏≤‡πÅ‡∏•‡πá‡∏Å‡∏ã‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡πÅ‡∏≠‡∏ô‡∏î‡∏£‡∏≠‡∏°‡∏¥‡∏î‡∏≤","‡∏ó‡∏≤‡∏á‡∏ä‡πâ‡∏≤‡∏á‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å","‡πÑ‡∏ï‡∏£‡πÅ‡∏≠‡∏á‡∏Å‡∏π‡∏•‡∏±‡∏°"], c:1},
            {q:"‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏î‡∏≤‡∏ß‡πÉ‡∏î?", a:["‡πÇ‡∏•‡∏Å","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏®‡∏∏‡∏Å‡∏£‡πå"], c:1},
            {q:"‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÑ‡∏ü Olympus Mons ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà?", a:["‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡πÇ‡∏•‡∏Å","‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå"], c:0},
            {q:"‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏¥‡∏®‡πÉ‡∏î?", a:["‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å","‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å","‡πÄ‡∏´‡∏ô‡∏∑‡∏≠"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏´‡∏≤‡∏á‡∏Æ‡∏±‡∏•‡πÄ‡∏•‡∏¢‡πå‡πÇ‡∏Ñ‡∏à‡∏£‡∏°‡∏≤‡∏ó‡∏∏‡∏Å‡∏Å‡∏µ‡πà‡∏õ‡∏µ?", a:["75 ‡∏õ‡∏µ","100 ‡∏õ‡∏µ","50 ‡∏õ‡∏µ"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ó‡∏¥‡∏®‡πÑ‡∏´‡∏ô?", a:["‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤","‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤","‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô"], c:0},
            {q:"‡∏¢‡∏≤‡∏ô‡∏≠‡∏ß‡∏Å‡∏≤‡∏®‡∏•‡∏≥‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå?", a:["Apollo 11","Sputnik 1","Voyager 1"], c:0},
            {q:"‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á‡πÉ‡∏´‡∏ç‡πà (Great Red Spot) ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà?", a:["‡∏î‡∏≤‡∏ß‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå"], c:0},
            {q:"‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏±‡∏î‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á?", a:["‡πÇ‡∏•‡∏Å-‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£-‡∏û‡∏§‡∏´‡∏±‡∏™","‡∏û‡∏§‡∏´‡∏±‡∏™-‡πÄ‡∏™‡∏≤‡∏£‡πå"], c:1},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö?", a:["‡∏ã‡∏µ‡∏£‡∏µ‡∏™","‡πÄ‡∏ß‡∏™‡∏ï‡∏≤","‡∏≠‡∏µ‡∏£‡∏≠‡∏™"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏´‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å?", a:["‡πÄ‡∏°‡∏Ü‡∏≠‡∏≠‡∏£‡πå‡∏ï","‡πÅ‡∏ñ‡∏ö‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏õ‡∏≠‡∏£‡πå","‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:0},
            {q:"1 ‡∏ß‡∏±‡∏ô‡∏ö‡∏ô‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå ‡∏ô‡∏≤‡∏ô‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏õ‡∏µ‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô?", a:["‡∏à‡∏£‡∏¥‡∏á","‡πÄ‡∏ó‡πá‡∏à","‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏§‡∏Å‡∏©‡πå‡∏î‡∏ß‡∏á‡πÉ‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ö‡∏ô‡∏ü‡πâ‡∏≤?", a:["‡∏ã‡∏¥‡∏£‡∏¥‡∏≠‡∏∏‡∏™","‡πÄ‡∏´‡∏ô‡∏∑‡∏≠","‡πÇ‡∏û‡∏•‡∏≤‡∏£‡∏¥‡∏™"], c:0},
            {q:"‡∏û‡∏≤‡∏¢‡∏∏‡∏ö‡∏ô‡∏î‡∏≤‡∏ß‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤?", a:["‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á‡πÉ‡∏´‡∏ç‡πà","‡∏ï‡∏≤‡∏û‡∏≤‡∏¢‡∏∏","‡πÑ‡∏ã‡πÇ‡∏Ñ‡∏•‡∏ô‡∏¢‡∏±‡∏Å‡∏©‡πå"], c:0},
            {q:"‡πÇ‡∏•‡∏Å‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì?", a:["150 ‡∏•‡πâ‡∏≤‡∏ô ‡∏Å‡∏°.","380,000 ‡∏Å‡∏°.","1 ‡∏õ‡∏µ‡πÅ‡∏™‡∏á"], c:0},
            {q:"‡∏ó‡∏≤‡∏á‡∏ä‡πâ‡∏≤‡∏á‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏°‡∏µ‡πÅ‡∏Å‡∏ô","‡∏ß‡∏á‡∏£‡∏µ","‡πÑ‡∏£‡πâ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏£‡∏∏‡πà‡∏á (Morning Star) ‡∏Ñ‡∏∑‡∏≠?", a:["‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏î‡∏≤‡∏ß‡∏û‡∏∏‡∏ò","‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏§‡∏Å‡∏©‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÇ‡∏•‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå)?", a:["Proxima Centauri","Sirius","Betelgeuse"], c:0},
            {q:"‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÇ‡∏ó‡∏£‡∏ó‡∏£‡∏£‡∏®‡∏ô‡πå‡∏≠‡∏ß‡∏Å‡∏≤‡∏®‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (2021)?", a:["James Webb","Hubble","Spitzer"], c:0},
            {q:"‡∏ù‡∏ô‡∏î‡∏≤‡∏ß‡∏ï‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?", a:["‡πÄ‡∏®‡∏©‡∏î‡∏≤‡∏ß‡∏´‡∏≤‡∏á","‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏î‡∏≤‡∏ß‡∏§‡∏Å‡∏©‡πå","‡∏•‡∏°‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞"], c:0},
            {q:"‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å?", a:["‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏±‡∏á‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡πÇ‡∏•‡∏Å‡∏ö‡∏±‡∏á‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏ö‡∏±‡∏á"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏Ñ‡∏£‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏•‡∏±‡∏Å?", a:["‡∏û‡∏•‡∏π‡πÇ‡∏ï","‡∏ã‡∏µ‡∏£‡∏µ‡∏™","‡∏≠‡∏µ‡∏£‡∏¥‡∏™"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏°‡∏µ‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Å‡∏µ‡πà‡∏î‡∏ß‡∏á?", a:["0","1","2"], c:0},
            {q:"‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‡∏°‡∏µ‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ä‡∏∑‡πà‡∏≠?", a:["Phobos, Deimos","Io, Europa","Titan, Rhea"], c:0}
        ];

        const snakes={14:4,20:8,32:28,34:22}, ladders={3:16,12:25,21:33}, mysteryBoxes=[7,18,26];
        const DEFAULT_DIFFICULTY = 'normal';
        const getGlobalScoreRef = () => collection(db, 'artifacts', GAME_APP_ID, 'public', 'data', 'global_scores');
        
        function getRankData(score) {
            if (score >= 3000) return { t: 'LEGEND', th: 'üëë Galactic Legend', c: 'text-yellow-400', bg: 'rank-badge-legend', next: Infinity, min: 3000 };
            if (score >= 1500) return { t: 'GUARDIAN', th: 'üåü Guardian', c: 'text-purple-400', bg: 'rank-badge-guardian', next: 3000, min: 1500 };
            if (score >= 800) return { t: 'ASTRONAUT', th: 'üë®‚ÄçüöÄ Astronaut', c: 'text-blue-400', bg: 'rank-badge-astronaut', next: 1500, min: 800 };
            if (score >= 500) return { t: 'TOURIST', th: 'üõ∏ Tourist', c: 'text-green-400', bg: 'rank-badge-tourist', next: 800, min: 500 };
            return { t: 'DUST', th: 'üåë Space Dust', c: 'text-slate-400', bg: 'rank-badge-dust', next: 500, min: 0 };
        }

        async function fetchPlayerStats(name, pid) { 
            const div = document.getElementById('lobby-profile'); div.innerHTML = '<div class="text-center text-xs text-slate-500 animate-pulse">Scanning Bio-Data...</div>';
            try { 
                const snap = await getDocs(getGlobalScoreRef()); let totalScore = 0;
                snap.forEach(d => { const dat = d.data(); if(dat.playerId === pid || dat.name === name) { totalScore += (dat.score || 0); } });
                const rank = getRankData(totalScore); const progress = rank.next === Infinity ? 100 : Math.min(100, Math.max(0, ((totalScore - rank.min) / (rank.next - rank.min)) * 100));
                div.innerHTML = `<div class="pilot-card p-5 rounded-2xl animate-fade-in text-left"><div class="flex justify-between items-start mb-3 border-b border-white/10 pb-2"><div><div class="text-[9px] text-cyan-400 uppercase tracking-widest flex items-center gap-1"><i class="fas fa-id-card"></i> STATUS: ACTIVE</div><div class="text-white font-bold text-xl tracking-wide">${name}</div></div><div class="w-10 h-10 rounded-full flex items-center justify-center text-2xl shadow-lg border border-white/20 ${rank.bg}">${selectedChar}</div></div><div class="mb-1"><div class="flex justify-between items-baseline mb-1"><div class="text-xs font-bold ${rank.c}">${rank.th}</div><div class="text-[10px] text-cyan-300 font-mono">${totalScore.toLocaleString()} XP</div></div><div class="w-full bg-slate-800/80 rounded-full h-1.5 overflow-hidden"><div class="bg-gradient-to-r from-cyan-400 to-blue-500 h-full rounded-full transition-all duration-1000" style="width: ${progress}%"></div></div></div></div>`; 
            } catch(e){ console.error(e); div.innerHTML='<div class="text-red-400 text-xs">Error</div>'; } 
        }

        async function saveGlobalScore(player, difficulty, extraScore) { 
            try { 
                const docId = `${player.id}_${difficulty}`; const globalRef = doc(collection(db, 'artifacts', GAME_APP_ID, 'public', 'data', 'global_scores'), docId); 
                const snap = await getDoc(globalRef); let currentScore = 0; if(snap.exists()) currentScore = snap.data().score || 0; 
                let newScore = currentScore + (extraScore || 0); if (newScore < 0) newScore = 0; 
                await setDoc(globalRef, { name: player.name, playerId: player.id, char: player.char, difficulty: difficulty, score: newScore, lastPlayed: serverTimestamp() }, { merge: true }); 
            } catch(e) { console.error("Save score error:", e); } 
        }

        window.showAnnouncement = (type, text, subtext = '') => {
            const overlay = document.getElementById('announcement-overlay');
            const content = document.getElementById('announcement-content');
            let color = '#fff', icon = '';
            
            if(type==='correct'){ color='#10b981'; icon='<i class="fas fa-check-circle text-5xl mb-2 animate-bounce"></i>'; }
            else if(type==='wrong'){ color='#ef4444'; icon='<i class="fas fa-times-circle text-5xl mb-2"></i>'; }
            else if(type==='warp'){ color='#06b6d4'; icon='<i class="fas fa-rocket text-5xl mb-2 animate-pulse"></i>'; }
            else if(type==='blackhole'){ color='#a855f7'; icon='<i class="fas fa-biohazard text-5xl mb-2 animate-spin-slow"></i>'; }
            else if(type==='box'){ color='#f59e0b'; icon='<i class="fas fa-gift text-5xl mb-2 animate-bounce"></i>'; }
            
            content.style.color = color;
            content.style.borderColor = color;
            content.style.boxShadow = `0 0 40px ${color}`;
            content.innerHTML = `${icon}<h2 class="text-4xl font-black uppercase tracking-wider mb-1" style="text-shadow:0 0 10px ${color}">${text}</h2><p class="text-white text-sm font-bold opacity-90 tracking-wide">${subtext}</p>`;
            content.className = 'announce-box active';
            
            overlay.classList.remove('hidden'); content.classList.add('active');
            setTimeout(() => {
                content.classList.remove('active');
                setTimeout(() => { overlay.classList.add('hidden'); }, 300);
            }, 2500);
        };

        window.createRoom = async () => { const btn=document.getElementById('create-btn'); btn.disabled=true; const rid=Math.random().toString(36).substring(2,6).toUpperCase(); try{ await setDoc(doc(db,"rooms",rid),{hostId:myPlayerId, status:'waiting', difficulty: DEFAULT_DIFFICULTY, startTime: null, players:[{id:myPlayerId, name:myPlayerName, pos:1, color:'#38bdf8', score:0, char:selectedChar}], turnIndex:0, lastAction:'‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', turnState:'quiz', createdAt:serverTimestamp()}); enterRoom(rid); }catch(e){alert(e.message);btn.disabled=false;} };
        window.joinRoom = async () => { 
            const rid=document.getElementById('room-code-input').value.trim().toUpperCase(); if(!rid)return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á"); 
            try{ const r=doc(db,"rooms",rid); const s=await getDoc(r); if(!s.exists())throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ"); const d=s.data(); 
                if(d.players.length >= MAX_PLAYERS && !d.players.find(p=>p.id===myPlayerId)) throw new Error("‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏° (‡∏à‡∏≥‡∏Å‡∏±‡∏î 4 ‡∏Ñ‡∏ô)");
                if(d.status!=='waiting'&&!d.players.find(p=>p.id===myPlayerId))throw new Error("‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß"); 
                if(!d.players.find(p=>p.id===myPlayerId)){ const colors=['#38bdf8','#f472b6','#4ade80','#fbbf24']; const myColor = colors[d.players.length] || '#fff'; await updateDoc(r,{players:[...d.players,{id:myPlayerId,name:myPlayerName,pos:1,color:myColor,score:0,char:selectedChar}]}); } enterRoom(rid); 
            }catch(e){alert(e.message);} 
        };
        
        function enterRoom(rid){ 
            if(unsubscribe)unsubscribe(); if(unsubscribeChat)unsubscribeChat(); if(timerInterval) clearInterval(timerInterval);
            currentRoomId=rid; document.getElementById('lobby-screen').style.display='none'; document.getElementById('game-room').style.display='flex'; document.getElementById('room-id-disp').innerText=rid; 
            unsubscribe=onSnapshot(doc(db,"rooms",rid),(d)=>{ if(d.exists()){ gameState=d.data(); renderUI(gameState); }else{ alert("‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡∏ö"); leaveRoom(); } }); 
            initChat(rid); setTimeout(()=>startCanvasLoop(),100); 
        }

        function initChat(rid) {
            const chatList = document.getElementById('chat-messages'); chatList.innerHTML = '<div class="text-center text-[10px] text-slate-500 py-2">-- SECURE CHANNEL --</div>';
            const q = query(collection(db, 'rooms', rid, 'messages'), orderBy('createdAt', 'asc'), limit(50));
            unsubscribeChat = onSnapshot(q, (snapshot) => { snapshot.docChanges().forEach((change) => { if (change.type === "added") { const msg = change.doc.data(); const isMe = msg.senderId === myPlayerId; const div = document.createElement('div'); div.className = `flex flex-col ${isMe ? 'items-end' : 'items-start'} animate-fade-in`; div.innerHTML = `<div class="text-[9px] text-slate-400 px-1 mb-0.5">${msg.senderName}</div><div class="chat-bubble ${isMe ? 'chat-mine' : 'chat-theirs'}">${msg.text}</div>`; chatList.appendChild(div); chatList.scrollTop = chatList.scrollHeight; if(!isMe) window.playSound('msg'); } }); });
        }

        window.sendMessage = async () => { const inp = document.getElementById('chat-input'); const txt = inp.value.trim(); if(!txt || !currentRoomId) return; inp.value = ''; try { await addDoc(collection(db, 'rooms', currentRoomId, 'messages'), { text: txt, senderId: myPlayerId, senderName: myPlayerName, createdAt: serverTimestamp() }); } catch(e) { console.error("Chat error", e); } };
        window.leaveRoom = async () => { if(currentRoomId && gameState){ try{ if (gameState.status === 'playing') { const me = gameState.players.find(p => p.id === myPlayerId); if(me) await saveGlobalScore(me, gameState.difficulty, -100); } const r = doc(db, "rooms", currentRoomId); const leavingIdx = gameState.players.findIndex(p => p.id === myPlayerId); const rem = gameState.players.filter(p => p.id !== myPlayerId); let up = { players: rem }; if(rem.length > 0){ if(gameState.hostId === myPlayerId) up.hostId = rem[0].id; if(gameState.status === 'playing'){ if(rem.length === 1){ up.status = 'finished'; up.winnerId = rem[0].id; up.lastAction = '‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏´‡∏ô‡∏µ! ‡∏ä‡∏ô‡∏∞‡∏ö‡∏≤‡∏¢ (+200 XP)'; await saveGlobalScore(rem[0], gameState.difficulty, 200); } else { let newTurn = gameState.turnIndex; if(leavingIdx < gameState.turnIndex) newTurn--; if(newTurn >= rem.length) newTurn = 0; up.turnIndex = newTurn; if(leavingIdx === gameState.turnIndex) { up.turnState = 'quiz'; up.lastAction = '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å! ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ'; } } } } await updateDoc(r, up); }catch(e){ console.error(e); } } if(unsubscribe)unsubscribe(); if(unsubscribeChat)unsubscribeChat(); if(timerInterval) clearInterval(timerInterval); currentRoomId=null; gameState=null; document.getElementById('game-room').style.display='none'; document.getElementById('lobby-screen').style.display='flex'; document.getElementById('leaderboard-modal').style.display='none'; document.getElementById('create-btn').disabled=false; if(myPlayerName) fetchPlayerStats(myPlayerName, myPlayerId); };
        window.addEventListener('beforeunload', () => { window.leaveRoom(); });
        window.selectChar=(c,el)=>{selectedChar=c;document.querySelectorAll('.char-select').forEach(e=>e.classList.remove('ring-2','ring-cyan-400','scale-110','bg-cyan-500/20'));el.classList.add('ring-2','ring-cyan-400','scale-110','bg-cyan-500/20');window.playSound('pop');};
        
        window.openGlobalLeaderboard=()=>{document.getElementById('global-leaderboard-modal').style.display='flex';filterGlobalLeaderboard();};
        window.closeGlobalLeaderboard=()=>{document.getElementById('global-leaderboard-modal').style.display='none';};
        window.filterGlobalLeaderboard = async () => { const l = document.getElementById('gl-list'); l.innerHTML = '<div class="text-center py-4 text-xs text-slate-400">Loading data...</div>'; const s = await getDocs(getGlobalScoreRef()); let sc = []; s.forEach(x => { const dat = x.data(); const k = dat.playerId || dat.name; let f = sc.find(i => i.pid === k); if(f) f.score += dat.score; else sc.push({ name: dat.name, score: dat.score, char: dat.char, pid: k }); }); sc.sort((a,b) => b.score - a.score); sc = sc.slice(0, 30); let h = ''; if(sc.length === 0) h = '<div class="text-center text-slate-500 py-4 text-xs">No Data</div>'; else { h += `<div class="grid grid-cols-12 gap-1 text-[10px] text-slate-500 uppercase mb-2 px-2 font-bold"><div class="col-span-2 text-center">#</div><div class="col-span-4">PILOT</div><div class="col-span-3 text-center">RANK</div><div class="col-span-3 text-right">XP</div></div>`; sc.forEach((p, i) => { const me = p.pid === myPlayerId; let rankClass = ''; if (i === 0) rankClass = 'rank-row-1'; else if (i === 1) rankClass = 'rank-row-2'; else if (i === 2) rankClass = 'rank-row-3'; const rData = getRankData(p.score); h += `<div class="grid grid-cols-12 gap-1 items-center p-2 rounded-lg mb-1 transition bg-slate-800/40 ${me ? 'border border-cyan-500/50 bg-cyan-900/20' : 'border border-white/5'} ${rankClass}"><div class="col-span-2 text-center font-bold text-sm text-slate-300">${i+1}</div><div class="col-span-4 truncate"><div class="font-bold text-xs ${me ? 'text-cyan-300' : 'text-slate-200'}">${p.char} ${p.name}</div></div><div class="col-span-3 text-center"><span class="text-[9px] px-1.5 py-0.5 rounded ${rData.c} bg-black/20 font-bold">${rData.t.split(' ')[1] || rData.t}</span></div><div class="col-span-3 text-right font-mono text-xs text-yellow-400">${p.score.toLocaleString()}</div></div>`; }); } l.innerHTML = h; };
        
        window.openCredits=()=>{document.getElementById('credits-modal').style.display='flex'; window.playSound('pop');}; 
        window.closeCredits=()=>{document.getElementById('credits-modal').style.display='none';};
        window.openRules=()=>{document.getElementById('rules-modal').style.display='flex'; window.playSound('pop');}; 
        window.closeRules=()=>{document.getElementById('rules-modal').style.display='none';};

        // --- RENDER & GAME ---
        function renderUI(state) {
            if(!state) return;
            document.getElementById('room-id-disp').innerText = currentRoomId;
            document.getElementById('room-id-disp-lg').innerText = currentRoomId;
            const skipBtn = document.getElementById('host-skip-btn');
            if(myPlayerId === state.hostId && state.status === 'playing') skipBtn.style.display = 'block'; else skipBtn.style.display = 'none';

            if(state.status === 'waiting') {
                document.getElementById('waiting-area').style.display = 'flex'; document.getElementById('game-area').style.display = 'none'; document.getElementById('leaderboard-modal').style.display = 'none'; document.getElementById('game-timer').style.display = 'none';
                const pList = document.getElementById('player-list');
                pList.innerHTML = state.players.map(p => `<div class="flex items-center justify-between glass-panel p-3 rounded-xl mb-2 border border-slate-600/30 transform transition hover:scale-105"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full flex items-center justify-center text-2xl shadow-lg" style="background:${p.color}20; color:${p.color}; border:1px solid ${p.color}50;">${p.char}</div><span class="font-bold text-sm" style="color:${p.color}">${p.name}</span></div>${p.id === state.hostId ? '<div class="text-yellow-500 text-[10px] border border-yellow-500/50 px-2 rounded-full">HOST</div>' : ''}</div>`).join('');
                const startBtn = document.getElementById('start-game-btn');
                if(myPlayerId === state.hostId) { startBtn.style.display = 'block'; startBtn.innerHTML = `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à (${state.players.length}/${MAX_PLAYERS})`; } else { startBtn.style.display = 'none'; }
            } else if (state.status === 'playing') {
                document.getElementById('waiting-area').style.display = 'none'; document.getElementById('game-area').style.display = 'flex'; document.getElementById('leaderboard-modal').style.display = 'none';
                
                if (state.players.length === 1 && state.startTime) {
                    const timerDiv = document.getElementById('game-timer'); timerDiv.style.display = 'block';
                    if (!timerInterval) {
                        timerInterval = setInterval(() => {
                            if (!gameState || gameState.status !== 'playing') { clearInterval(timerInterval); return; }
                            const now = Date.now(); const elapsed = now - gameState.startTime; const remaining = Math.max(0, SOLO_TIME_LIMIT - elapsed);
                            const mins = Math.floor(remaining / 60000); const secs = Math.floor((remaining % 60000) / 1000);
                            timerDiv.innerHTML = `<i class="fas fa-clock"></i> ${mins}:${secs.toString().padStart(2, '0')}`;
                            if (remaining <= 30000) timerDiv.classList.add('timer-warning'); else timerDiv.classList.remove('timer-warning');
                            if (remaining <= 0 && myPlayerId === gameState.hostId) { clearInterval(timerInterval); handleSoloTimeout(); }
                        }, 1000);
                    }
                } else { document.getElementById('game-timer').style.display = 'none'; if(timerInterval) clearInterval(timerInterval); }

                const turnPlayer = state.players[state.turnIndex];
                const isMyTurn = turnPlayer.id === myPlayerId;
                
                document.getElementById('turn-text').innerHTML = `<div class="flex flex-col"><span class="text-[10px] text-slate-400 uppercase tracking-widest">TURN</span><span class="font-bold text-lg flex items-center gap-2" style="color:${turnPlayer.color}">${turnPlayer.char} ${turnPlayer.name} ${isMyTurn ? '(YOU)' : ''}</span></div>`;
                document.getElementById('log-text').innerHTML = `<span class="text-cyan-300 font-mono text-xs border border-cyan-500/30 px-2 py-1 rounded bg-cyan-900/30 whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px] inline-block">${state.lastAction || 'Start!'}</span>`;
                
                const actionContainer = document.getElementById('action-btn-container');
                actionContainer.innerHTML = '';
                if (isMyTurn && !isProcessingAction) {
                    if (state.turnState === 'quiz') { actionContainer.innerHTML = `<button onclick="window.startTurn()" class="w-full h-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold text-lg rounded-xl shadow-lg border-t border-blue-400 transition-all active:scale-95 uppercase tracking-widest">ANSWER</button>`; } 
                    else if (state.turnState === 'roll') { actionContainer.innerHTML = `<button onclick="window.rollDice()" class="w-full h-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold text-lg rounded-xl shadow-lg border-t border-orange-400 transition-all active:scale-95 uppercase tracking-widest">ROLL DICE</button>`; }
                    else { actionContainer.innerHTML = `<div class="text-slate-400 text-xs animate-pulse text-center">SYSTEM CALCULATING...</div>`; }
                } else if (!isMyTurn) { actionContainer.innerHTML = `<div class="w-full h-full flex items-center justify-center text-slate-500 bg-slate-800/30 rounded-xl text-sm italic">Waiting for pilot...</div>`; }
            } else if (state.status === 'finished') {
                if(timerInterval) clearInterval(timerInterval);
                const sortedPlayers = [...state.players].sort((a,b) => b.score - a.score);
                document.getElementById('leaderboard-modal').style.display = 'flex';
                let resultTitle = "MISSION COMPLETE"; if (state.players.length === 1 && !state.winnerId) resultTitle = "MISSION FAILED";
                document.getElementById('result-title').innerText = resultTitle;
                
                document.getElementById('ranking-list').innerHTML = sortedPlayers.map((p, i) => {
                    let deltaText = "", deltaClass = "";
                    const isSolo = state.players.length === 1;
                    if (isSolo) {
                        if (state.winnerId) { deltaText = "+500"; deltaClass = "text-green-400"; }
                        else { deltaText = "-200"; deltaClass = "text-red-400"; }
                    } else {
                        if (i === 0) { deltaText = "+500"; deltaClass = "text-green-400"; }
                        else if (i === 1) { deltaText = "+200"; deltaClass = "text-yellow-400"; }
                        else if (i === 2) { deltaText = "+50"; deltaClass = "text-blue-400"; }
                        else { deltaText = "-200"; deltaClass = "text-red-400"; }
                    }
                    return `<div class="flex justify-between items-center p-3 ${p.id===state.winnerId ? 'bg-gradient-to-r from-yellow-900/40 to-transparent border-l-4 border-yellow-400' : 'bg-slate-800/50'} mb-2 rounded-lg"><span class="flex items-center gap-3"><span class="text-xl">${i===0 ? 'ü•á' : i===1 ? 'ü•à' : i===2 ? 'ü•â' : 'üíÄ'}</span> <span class="text-white font-bold text-sm">${p.name}</span></span><div class="text-right"><span class="font-black text-lg ${deltaClass}">${deltaText} XP</span><div class="text-[9px] text-slate-500 uppercase">Rank Update</div></div></div>`;
                }).join('');
                
                const resetBtn = document.getElementById('reset-game-btn'); if(myPlayerId === state.hostId) { resetBtn.style.display = 'block'; } else { resetBtn.style.display = 'none'; }
            }
        }
        window.renderUI = renderUI;
        
        window.skipTurnHost = async () => { if(!currentRoomId || !gameState) return; if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô?")) return; try { const nextIdx = (gameState.turnIndex + 1) % gameState.players.length; await updateDoc(doc(db, "rooms", currentRoomId), { turnIndex: nextIdx, turnState: 'quiz', lastAction: 'Admin Override' }); } catch(e) { console.error(e); } };

        window.startGameHost = async () => { if(!currentRoomId) return; try { window.playSound('warp'); await updateDoc(doc(db, "rooms", currentRoomId), { status: 'playing', startTime: Date.now(), turnIndex: 0, turnState: 'quiz', lastAction: 'üöÄ LAUNCH!', players: gameState.players.map(p => ({...p, pos: 1, score: 0})) }); } catch(e) { console.error(e); } };
        window.handleSoloTimeout = async () => { if (!currentRoomId || !gameState) return; window.playSound('timeout'); const p = gameState.players[0]; await saveGlobalScore(p, gameState.difficulty, -200); await updateDoc(doc(db, "rooms", currentRoomId), { status: 'finished', winnerId: null, lastAction: 'TIMEOUT! (-200 XP)' }); };
        window.resetGameHost = async () => { if(!currentRoomId) return; await updateDoc(doc(db, "rooms", currentRoomId), { status: 'waiting', startTime: null, lastAction: 'REBOOT SYSTEM', winnerId: null, players: gameState.players.map(p => ({...p, pos: 1, score: 0})) }); };

        // --- NEW CANVAS VISUALS ---
        let canvas, ctx, animationId; let visualPlayers = {}; let pulseTime = 0;
        function startCanvasLoop(){ canvas=document.getElementById('game-canvas'); if(!canvas)return; ctx=canvas.getContext('2d'); const dpr=window.devicePixelRatio||1; const r=canvas.getBoundingClientRect(); if(r.width===0){requestAnimationFrame(startCanvasLoop);return;} canvas.width=r.width*dpr; canvas.height=r.height*dpr; ctx.scale(dpr,dpr); if(animationId)cancelAnimationFrame(animationId); gameLoop(); }
        window.addEventListener('resize',()=>{if(canvas)startCanvasLoop();});
        function getCanvasCoords(pos){ if(!canvas)return{x:0,y:0}; if(pos<1)pos=1; if(pos>36)pos=36; const r=canvas.getBoundingClientRect(); const cw=r.width/GRID_SIZE; const ch=r.height/GRID_SIZE; const idx=pos-1; const row=Math.floor(idx/6); let col=idx%6; if(row%2!==0)col=5-col; return {x:(col*cw)+(cw/2), y:((5-row)*ch)+(ch/2), w:cw, h:ch}; }
        
        function updateVisuals(){ 
            if(!gameState)return; 
            gameState.players.forEach(p=>{ 
                if(!visualPlayers[p.id])visualPlayers[p.id]={x:getCanvasCoords(p.pos).x, y:getCanvasCoords(p.pos).y, currentPos:p.pos, queue:[]}; 
                const vp=visualPlayers[p.id]; 
                
                // --- Step Logic ---
                if(p.pos !== vp.currentPos && vp.queue.length === 0){ 
                    const diff = p.pos - vp.currentPos;
                    if(Math.abs(diff) <= 6 && Math.abs(diff) > 0) {
                        const dir = diff > 0 ? 1 : -1;
                        let next = vp.currentPos;
                        for(let i=0; i < Math.abs(diff); i++) {
                            next += dir;
                            vp.queue.push({type:'step', to: next});
                        }
                    } else {
                        vp.queue.push({type:'slide', to:p.pos}); 
                    }
                    vp.currentPos = p.pos; 
                } 
                
                if(vp.queue.length>0){ 
                    const targetStep = vp.queue[0];
                    const t=getCanvasCoords(targetStep.to); const dx=t.x-vp.x, dy=t.y-vp.y, d=Math.sqrt(dx*dx+dy*dy); 
                    const speed = targetStep.type === 'slide' ? 20 : 5; 
                    
                    if(d<speed){
                        vp.x=t.x; vp.y=t.y; 
                        vp.queue.shift(); 
                        if(targetStep.type === 'step') window.playSound('step');
                    } else{
                        vp.x+=dx/d*speed; vp.y+=dy/d*speed;
                    } 
                } else { 
                    const f=getCanvasCoords(p.pos); vp.x+=(f.x-vp.x)*0.2; vp.y+=(f.y-vp.y)*0.2; 
                } 
            }); 
        }

        function drawConnector(from, to, color, type) { 
            const start = getCanvasCoords(from); const end = getCanvasCoords(to); 
            const time = Date.now() / 200;
            ctx.beginPath(); ctx.moveTo(start.x, start.y); 
            const cx = (start.x + end.x) / 2 + (type==='ladder' ? 30 : -30); const cy = (start.y + end.y) / 2; 
            ctx.quadraticCurveTo(cx, cy, end.x, end.y); 
            ctx.lineWidth = type==='ladder' ? 4 : 3; 
            ctx.strokeStyle = color; 
            ctx.lineCap = 'round'; 
            ctx.shadowBlur = 15; ctx.shadowColor = color; 
            if(type==='ladder') { ctx.setLineDash([10, 10]); ctx.lineDashOffset = -time; } else { ctx.setLineDash([]); } 
            ctx.stroke(); 
            ctx.setLineDash([]); ctx.shadowBlur = 0; 
            const angle = Math.atan2(end.y - cy, end.x - cx); 
            ctx.beginPath(); ctx.moveTo(end.x, end.y); 
            ctx.lineTo(end.x - 10 * Math.cos(angle - Math.PI / 6), end.y - 10 * Math.sin(angle - Math.PI / 6)); 
            ctx.lineTo(end.x - 10 * Math.cos(angle + Math.PI / 6), end.y - 10 * Math.sin(angle + Math.PI / 6)); 
            ctx.fillStyle = color; ctx.fill(); 
        }

        function gameLoop(){ 
            if(!ctx||!canvas)return; pulseTime+=0.05; 
            const w=canvas.width/(window.devicePixelRatio||1), h=canvas.height/(window.devicePixelRatio||1); 
            ctx.clearRect(0,0,w,h); 
            updateVisuals(); 

            // Draw Tiles
            for(let i=1;i<=36;i++){ 
                const c=getCanvasCoords(i); 
                const isSpecial = mysteryBoxes.includes(i) || i===1 || i===36;
                let stroke = 'rgba(56, 189, 248, 0.2)'; let shadow = 'transparent'; let lw=1;
                if (i===1) { stroke='#4ade80'; shadow='#4ade80'; lw=2; }
                else if (i===36) { stroke='#fbbf24'; shadow='#fbbf24'; lw=2; }
                else if (mysteryBoxes.includes(i)) { stroke='#d946ef'; shadow='#d946ef'; lw=2; }

                ctx.beginPath();
                const pad = 4; const r=8;
                const x=c.x-c.w/2+pad; const y=c.y-c.h/2+pad; const tw=c.w-2*pad; const th=c.h-2*pad;
                ctx.roundRect(x,y,tw,th,r);
                ctx.fillStyle = 'rgba(15, 23, 42, 0.4)'; ctx.fill();
                ctx.shadowBlur=lw===2?15:0; ctx.shadowColor=shadow; ctx.strokeStyle=stroke; ctx.lineWidth=lw; ctx.stroke(); ctx.shadowBlur=0;
                
                ctx.fillStyle = isSpecial ? '#fff' : 'rgba(255,255,255,0.4)'; ctx.font = isSpecial ? "bold 12px Kanit" : "10px Kanit";
                ctx.textAlign="left"; ctx.textBaseline="top"; ctx.fillText(i, x+6, y+6);
                
                ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.font="24px Arial";
                
                // Draw Icons
                if(i===1)ctx.fillText("üöÄ",c.x,c.y); 
                else if(i===36)ctx.fillText("ü™ê",c.x,c.y); 
                else if(mysteryBoxes.includes(i)) { 
                    const s = 1 + Math.sin(pulseTime*2)*0.1; 
                    ctx.save(); ctx.translate(c.x,c.y); ctx.scale(s,s); ctx.fillText("üéÅ",0,0); ctx.restore(); 
                }
                // Rocket icon at ladder start
                else if (ladders[i]) {
                     ctx.font="30px Arial";
                     ctx.fillText("üöÄ", c.x, c.y);
                }
                // Blackhole icon at snake start
                else if (snakes[i]) {
                     ctx.font="30px Arial";
                     ctx.fillText("üå™Ô∏è", c.x, c.y);
                }
            }
            
            for(let start in ladders) { drawConnector(parseInt(start), ladders[start], '#06b6d4', 'ladder'); } 
            for(let start in snakes) { drawConnector(parseInt(start), snakes[start], '#ef4444', 'snake'); }
            
            if(gameState&&gameState.players) gameState.players.forEach((p,i)=>{ 
                const vp=visualPlayers[p.id]; 
                if(vp){ 
                    const ox=(i%2===0)?-5:5, oy=(i>1)?-5:5; 
                    ctx.shadowBlur = 20; ctx.shadowColor = p.color;
                    ctx.beginPath(); ctx.arc(vp.x+ox,vp.y+oy,16,0,Math.PI*2); 
                    ctx.fillStyle=p.color; ctx.fill(); ctx.shadowBlur=0;
                    ctx.lineWidth = 2; ctx.strokeStyle = "#fff"; ctx.stroke(); 
                    ctx.font="20px Arial"; ctx.fillStyle="#000"; ctx.textAlign="center"; ctx.textBaseline="middle"; 
                    ctx.fillText(p.char, vp.x+ox, vp.y+oy+2); 
                } 
            }); 
            animationId=requestAnimationFrame(gameLoop); 
        }

        window.startTurn = () => { document.getElementById('question-modal').style.display='flex'; const q=QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)]; window.currentQ=q; document.getElementById('q-text').innerText=q.q; document.getElementById('q-answers').innerHTML=q.a.map((a,i)=> `<button onclick="submitAnswer(${i})" class="w-full p-4 bg-slate-800/80 hover:bg-cyan-600/80 border border-slate-600 hover:border-cyan-400 mb-3 rounded-xl text-white font-medium transition-all text-lg shadow-lg transform hover:-translate-y-1">${a}</button>`).join(''); };
        
        window.submitAnswer = async(i) => { 
            document.getElementById('question-modal').style.display='none'; 
            if(i===window.currentQ.c){ 
                window.playSound('correct'); window.showAnnouncement('correct', 'ACCESS GRANTED', '+50 XP');
                await updateDoc(doc(db,"rooms",currentRoomId),{lastAction:'‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å! (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ó‡∏≠‡∏¢)', turnState:'roll', players:gameState.players.map((p,idx)=>idx===gameState.turnIndex?{...p,score:p.score+50}:p)}); 
            } else { 
                window.playSound('wrong'); window.showAnnouncement('wrong', 'ACCESS DENIED', '-30 XP');
                let ps = [...gameState.players]; ps[gameState.turnIndex].score = Math.max(0, ps[gameState.turnIndex].score - 30); await updateDoc(doc(db,"rooms",currentRoomId),{players:ps});
                await handleMove(Math.max(1,gameState.players[gameState.turnIndex].pos-3),'‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! (-30 XP)', true); 
            } 
        };
        
        window.rollDice = () => { if(isProcessingAction) return; isProcessingAction = true; const modal = document.getElementById('dice-action-modal'); const cube = document.getElementById('dice-cube'); modal.style.display = 'flex'; cube.className = 'cube animate-spin-dice'; window.playSound('dice'); setTimeout(() => { const v = Math.floor(Math.random() * 6) + 1; cube.className = `cube show-${v}`; setTimeout(() => { modal.style.display = 'none'; isProcessingAction = false; handleMove(Math.min(36, gameState.players[gameState.turnIndex].pos + v), `‡∏ó‡∏≠‡∏¢‡πÑ‡∏î‡πâ ${v}`, true); }, 1500); }, 1000); };
        
        async function handleMove(t,m,e) { 
            let ps=[...gameState.players]; ps[gameState.turnIndex].pos=t; 
            await updateDoc(doc(db,"rooms",currentRoomId),{players:ps,lastAction:m,turnState:'moving'}); 
            
            setTimeout(async()=>{ 
                if(!currentRoomId || !gameState) return;
                let f=t; let msg = ''; let extraXp = 0;

                if(ladders[t]){ f=ladders[t]; msg='‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏π‡∏´‡∏ô‡∏≠‡∏ô! üöÄ'; window.showAnnouncement('warp', 'WARP ZONE', 'Hyper-Speed Active'); }
                else if(snakes[t]){ 
                    f=snakes[t]; msg='‡πÇ‡∏î‡∏ô‡∏´‡∏•‡∏∏‡∏°‡∏î‡∏≥‡∏î‡∏π‡∏î! (-50 XP) üå™Ô∏è'; 
                    window.showAnnouncement('blackhole', 'BLACK HOLE', 'Critical Failure');
                    ps[gameState.turnIndex].score = Math.max(0, ps[gameState.turnIndex].score - 50);
                }
                else if(mysteryBoxes.includes(t)) {
                    // --- NEW MYSTERY BOX LOGIC (Random Effects) ---
                    const luck = Math.random();
                    if (luck < 0.4) {
                        const bonus = 200;
                        msg = `‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡πà‡∏°! (+${bonus} XP) üéÅ`;
                        ps[gameState.turnIndex].score += bonus;
                        extraXp = bonus;
                        window.playSound('pop'); 
                        window.showAnnouncement('box', 'LUCKY DROP', `Bonus +${bonus} XP`);
                    } else if (luck < 0.7) {
                        const steps = Math.floor(Math.random() * 2) + 1;
                        f = Math.min(36, t + steps);
                        msg = `‡∏ö‡∏π‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô! ‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ${steps} ‡∏ä‡πà‡∏≠‡∏á üöÄ`;
                        window.playSound('warp');
                        window.showAnnouncement('warp', 'BOOSTER ON', `Forward ${steps} steps`);
                    } else {
                        const steps = Math.floor(Math.random() * 2) + 1;
                        f = Math.max(1, t - steps);
                        msg = `‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏ô! ‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á ${steps} ‡∏ä‡πà‡∏≠‡∏á ‚ö†Ô∏è`;
                        window.playSound('glitch'); 
                        window.showAnnouncement('wrong', 'SYSTEM GLITCH', `Back ${steps} steps`);
                    }
                }
                
                if(extraXp > 0) { await saveGlobalScore(ps[gameState.turnIndex], gameState.difficulty, extraXp); }

                if(f!==t || extraXp > 0){ 
                    ps[gameState.turnIndex].pos=f; 
                    await updateDoc(doc(db,"rooms",currentRoomId),{players:ps,lastAction:msg}); 
                    if(f!==t && !ladders[t] && !snakes[t]) { /* Sound handled above for boxes */ }
                    else if(f!==t) window.playSound(ladders[t] ? 'warp' : 'fall'); 
                } 
                
                setTimeout(async()=>{ 
                    if(!currentRoomId || !gameState) return;
                    if(f===36){ 
                        const winner = ps[gameState.turnIndex]; winner.score += 500;
                        await saveGlobalScore(winner, gameState.difficulty, 500); 
                        const losers = ps.filter(p => p.id !== winner.id);
                        losers.sort((a,b) => { if (b.pos !== a.pos) return b.pos - a.pos; return b.score - a.score; });
                        if(losers[0]) await saveGlobalScore(losers[0], gameState.difficulty, 200);
                        if(losers[1]) await saveGlobalScore(losers[1], gameState.difficulty, 50);
                        if(losers[2]) await saveGlobalScore(losers[2], gameState.difficulty, -200);

                        await updateDoc(doc(db,"rooms",currentRoomId),{players:ps,status:'finished',winnerId:winner.id}); 
                        window.playSound('win');
                    } else if((e && extraXp === 0) || (extraXp > 0 || f !== t)){ 
                        if(f!==36) { await saveGlobalScore(ps[gameState.turnIndex], gameState.difficulty, 0); await updateDoc(doc(db,"rooms",currentRoomId),{turnIndex:(gameState.turnIndex+1)%ps.length, turnState:'quiz', lastAction: '‡∏à‡∏ö‡∏ï‡∏≤'}); }
                    } 
                },2500); 
            },2500); 
        }
    </script>
</head>
<body class="h-screen w-screen flex flex-col space-bg text-white font-sans overflow-hidden">
    <div class="stars"></div>

    <!-- Announcement Overlay -->
    <div id="announcement-overlay" class="announce-overlay hidden">
        <div id="announcement-content" class="announce-box"></div>
    </div>

    <div id="loading-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-slate-950 cursor-pointer" onclick="enterGame()">
        <div class="relative mb-6"><div class="absolute inset-0 bg-cyan-500 blur-[80px] opacity-30 animate-pulse"></div><div class="text-8xl animate-bounce relative z-10 filter drop-shadow-[0_0_20px_rgba(6,182,212,0.8)]">ü™ê</div></div>
        <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 mb-4 tracking-tighter filter drop-shadow-lg text-center px-4 text-shadow-neon">SOLAR SNAKES<br><span class="text-sm font-normal text-slate-300 tracking-[0.5em] bg-none text-white">NEON EDITION</span></h1>
        <button id="enter-btn" class="glass-panel text-cyan-300 border-cyan-500/50 hover:bg-cyan-500/20 font-bold py-4 px-12 rounded-full shadow-[0_0_30px_rgba(6,182,212,0.4)] transition transform hover:scale-110 active:scale-95 text-lg tracking-widest border-2">START MISSION</button>
    </div>

    <!-- Auth Screens -->
    <div id="login-screen" class="fixed inset-0 z-40 flex flex-col items-center justify-center hidden">
        <div class="w-full max-w-sm p-8 rounded-3xl glass-panel relative border-t border-slate-500/50">
            <h2 class="text-2xl font-bold text-center mb-6 text-white tracking-wide">Solar Snakes</h2>
            <div id="auth-menu" class="flex flex-col gap-3">
                <button onclick="showLoginMode()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg transition text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <button onclick="showRegisterMode()" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl shadow-lg transition text-sm">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</button>
            </div>
            <div id="login-form" class="space-y-3 hidden animate-fade-in-up">
                <input type="text" id="login-name" class="w-full glass-input rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô">
                <input type="password" id="login-pass" class="w-full glass-input rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none text-sm" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <div id="login-error-msg" class="text-red-400 text-xs text-center hidden"></div>
                <button id="btn-login-confirm" onclick="doLogin()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg transition mt-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                <div class="flex justify-between items-center mt-4"><button onclick="showAuthMenu()" class="text-slate-400 text-xs hover:text-white">‡∏Å‡∏•‡∏±‡∏ö</button><span onclick="openForgotPass()" class="text-xs text-cyan-400 cursor-pointer">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</span></div>
            </div>
            <div id="register-form" class="space-y-3 hidden animate-fade-in-up">
                <input type="text" id="reg-name" class="w-full glass-input rounded-xl px-4 py-2 text-white placeholder-slate-500 text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô">
                <input type="email" id="reg-email" class="w-full glass-input rounded-xl px-4 py-2 text-white placeholder-slate-500 text-sm" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input type="password" id="reg-pass" class="w-full glass-input rounded-xl px-4 py-2 text-white placeholder-slate-500 text-sm" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <input type="password" id="reg-confirm" class="w-full glass-input rounded-xl px-4 py-2 text-white placeholder-slate-500 text-sm" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <div id="reg-error-msg" class="text-red-400 text-xs text-center hidden"></div>
                <button id="btn-register-confirm" onclick="doRegister()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl shadow-lg transition mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                <div class="mt-4"><button onclick="showAuthMenu()" class="text-slate-400 text-xs hover:text-white">‡∏Å‡∏•‡∏±‡∏ö</button></div>
            </div>
        </div>
    </div>

    <!-- Lobby -->
    <div id="lobby-screen" class="flex-1 flex flex-col items-center justify-center p-4 relative hidden">
        <div class="absolute top-4 right-4 z-20 flex gap-2">
            <button onclick="toggleBGM()" class="bg-slate-800/50 text-slate-300 p-2 rounded-full w-10 h-10 flex items-center justify-center border border-slate-600 hover:bg-slate-700 transition"><i class="fas fa-music text-sm"></i></button>
            <button onclick="window.logout()" class="bg-red-900/30 text-red-400 p-2 rounded-full w-10 h-10 flex items-center justify-center border border-red-500/30 hover:bg-red-900/50 transition"><i class="fas fa-power-off text-sm"></i></button>
        </div>
        <div class="w-full max-w-md glass-panel p-6 rounded-3xl relative animate-fade-in border-t border-slate-500/30">
            <div class="text-center mb-6"><h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-white to-purple-400 italic text-shadow-neon transform -skew-x-6">SOLAR SNAKES</h1></div>
            <div id="lobby-profile" class="mb-6 min-h-[80px]"></div>
            <div class="mb-6 text-center bg-slate-900/60 p-3 rounded-2xl border border-slate-700/50 shadow-inner"><label class="text-[10px] text-slate-400 mb-2 block uppercase tracking-[0.2em]">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏±‡∏õ‡∏ï‡∏±‡∏ô</label><div class="flex justify-center gap-4"><div onclick="selectChar('üë®‚ÄçüöÄ', this)" class="char-select text-4xl cursor-pointer p-3 rounded-xl bg-slate-800 ring-2 ring-cyan-400 bg-cyan-900/30 scale-110 transition hover:scale-125">üë®‚ÄçüöÄ</div><div onclick="selectChar('üëΩ', this)" class="char-select text-4xl cursor-pointer p-3 rounded-xl bg-slate-800 transition hover:bg-slate-700 hover:scale-110">üëΩ</div><div onclick="selectChar('ü§ñ', this)" class="char-select text-4xl cursor-pointer p-3 rounded-xl bg-slate-800 transition hover:bg-slate-700 hover:scale-110">ü§ñ</div></div></div>
            <div class="space-y-3 mb-6"><button id="create-btn" onclick="createRoom()" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(16,185,129,0.4)] transition text-lg uppercase tracking-widest border border-emerald-400/50">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button></div>
            <div class="flex gap-2 mb-6"><input type="text" id="room-code-input" class="flex-1 glass-input rounded-xl px-4 py-3 text-center uppercase tracking-[0.3em] font-black text-xl placeholder-slate-600 text-cyan-300" placeholder="CODE"><button onclick="joinRoom()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-8 rounded-xl font-bold transition shadow-lg text-sm border-t border-indigo-400">JOIN</button></div>
            <div class="grid grid-cols-3 gap-2">
                <button onclick="openGlobalLeaderboard()" class="glass-panel hover:bg-slate-800 py-3 rounded-xl text-xs font-bold text-yellow-300 transition flex items-center justify-center gap-2 border border-yellow-500/20 flex-col"><i class="fas fa-trophy text-lg"></i> ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å</button>
                <button onclick="openRules()" class="glass-panel hover:bg-slate-800 py-3 rounded-xl text-xs font-bold text-cyan-300 transition flex items-center justify-center gap-2 border border-cyan-500/20 flex-col"><i class="fas fa-book text-lg"></i> ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤</button>
                <button onclick="openCredits()" class="glass-panel hover:bg-slate-800 py-3 rounded-xl text-xs font-bold text-pink-300 transition flex items-center justify-center gap-2 border border-pink-500/20 flex-col"><i class="fas fa-users text-lg"></i> ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥</button>
            </div>
        </div>
    </div>

    <!-- Game Room -->
    <div id="game-room" class="flex-1 flex flex-col h-full relative hidden">
        <div class="flex justify-between items-center p-3 glass-panel z-20 mx-2 mt-2 rounded-xl border-cyan-500/30">
            <div class="flex items-center gap-3">
                <div class="bg-slate-900/80 px-3 py-1 rounded-lg border border-slate-600 text-center shadow-inner"><div class="text-[8px] text-slate-500 uppercase tracking-widest">CODE</div><span id="room-id-disp" class="text-cyan-400 font-mono font-bold text-lg tracking-widest">...</span></div>
                <div id="game-timer" class="text-white font-mono font-bold text-lg bg-slate-900/80 px-3 py-1 rounded-lg border border-slate-600 shadow-[0_0_10px_rgba(0,0,0,0.5)]" style="display:none;"></div>
                <div id="host-skip-btn" style="display:none;"><button onclick="skipTurnHost()" class="bg-red-500/20 text-red-400 px-3 py-1 rounded border border-red-500/30 text-[10px] hover:bg-red-500/40 font-bold uppercase">Skip Turn</button></div>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleBGM()" class="bg-slate-800 text-slate-300 w-10 h-10 rounded-full flex items-center justify-center border border-slate-600 hover:bg-slate-700"><i class="fas fa-music"></i></button>
                <button onclick="leaveRoom()" class="bg-red-900/30 text-red-400 px-4 py-1 rounded-lg text-xs font-bold border border-red-500/30 hover:bg-red-900/50 transition uppercase tracking-wide">Exit</button>
            </div>
        </div>
        
        <div id="waiting-area" class="flex-1 flex flex-col items-center justify-center p-6 space-y-8">
            <div class="text-center relative">
                <div class="absolute inset-0 bg-cyan-500 blur-[60px] opacity-20 animate-pulse rounded-full"></div>
                <h2 class="text-3xl font-bold text-white relative z-10 mb-2 uppercase tracking-widest">Lobby</h2>
                <div class="text-6xl font-mono font-black text-slate-500 tracking-widest opacity-50" id="room-id-disp-lg">...</div>
            </div>
            <div id="player-list" class="w-full max-w-sm space-y-3"></div>
            <button id="start-game-btn" onclick="startGameHost()" class="w-full max-w-xs py-4 bg-gradient-to-r from-emerald-500 to-cyan-600 text-white font-black rounded-2xl shadow-[0_0_30px_rgba(16,185,129,0.4)] hover:scale-105 transition hidden text-xl tracking-[0.2em] border border-emerald-400/50"></button>
            <div class="w-full max-w-sm flex-1 min-h-[150px] glass-panel rounded-xl flex flex-col overflow-hidden border-slate-700">
                <div class="bg-slate-900/80 px-3 py-2 text-xs font-bold text-cyan-500 border-b border-white/5 uppercase tracking-wider flex items-center gap-2"><i class="fas fa-satellite-dish"></i> Secure Comms</div>
                <div id="chat-messages" class="flex-1 p-3 overflow-y-auto flex flex-col gap-2 no-scrollbar bg-slate-900/40"></div>
                <div class="p-2 bg-slate-900/80 flex gap-2 border-t border-white/5">
                    <input id="chat-input" type="text" class="flex-1 bg-transparent text-white text-xs focus:outline-none placeholder-slate-600" placeholder="Type message..." onkeypress="if(event.key==='Enter') window.sendMessage()">
                    <button onclick="window.sendMessage()" class="text-cyan-400 hover:text-cyan-200"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <div id="game-area" class="flex-1 flex flex-col relative overflow-hidden hidden">
            <div class="flex-1 flex flex-col items-center justify-center p-2 relative z-10">
                <div class="relative w-full max-w-[600px] aspect-square shadow-[0_0_50px_rgba(0,0,0,0.8)] rounded-2xl overflow-hidden glass-panel border border-slate-500/30">
                    <canvas id="game-canvas" class="w-full h-full"></canvas>
                </div>
            </div>
            <div class="glass-panel border-t border-slate-600/50 p-6 pb-8 rounded-t-3xl z-30 relative -mt-6 backdrop-blur-2xl bg-slate-900/90 flex flex-col gap-4 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
                <div class="flex justify-between items-center">
                    <div id="turn-text" class="text-white">...</div>
                    <div id="log-text"></div>
                </div>
                <div id="action-btn-container" class="h-16"></div>
                <div class="flex justify-center"><button onclick="document.getElementById('waiting-area').querySelector('#chat-messages').parentElement.classList.toggle('absolute'); document.getElementById('waiting-area').querySelector('#chat-messages').parentElement.classList.toggle('bottom-24'); document.getElementById('waiting-area').querySelector('#chat-messages').parentElement.classList.toggle('z-50'); document.getElementById('waiting-area').querySelector('#chat-messages').parentElement.classList.toggle('w-72'); document.getElementById('waiting-area').querySelector('#chat-messages').parentElement.classList.toggle('right-4');" class="text-[10px] text-slate-500 uppercase tracking-widest hover:text-white transition flex items-center gap-2"><i class="far fa-comment-dots"></i> Toggle Comms</button></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="forgot-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden animate-fade-in"><div class="w-full max-w-sm p-6 rounded-3xl glass-panel border border-slate-600 shadow-2xl"><h3 class="text-lg font-bold text-white mb-4">Reset Password</h3><div id="forgot-step-1"><input type="text" id="forgot-name" class="w-full glass-input rounded-xl px-4 py-2 text-white mb-2 text-sm" placeholder="Pilot Name"><input type="email" id="forgot-email" class="w-full glass-input rounded-xl px-4 py-2 text-white mb-4 text-sm" placeholder="Email"><button id="send-email-btn" onclick="sendResetOTP()" class="w-full bg-cyan-600 text-white py-2 rounded-xl font-bold mb-2 text-sm">Send OTP</button><div id="hint-result" class="text-center text-xs text-slate-300 min-h-[20px]"></div></div><div id="forgot-step-2" style="display:none;"><input type="text" id="reset-otp" class="w-full glass-input rounded-xl px-4 py-2 text-white mb-2 text-center tracking-widest" placeholder="OTP CODE"><input type="password" id="reset-new-pass" class="w-full glass-input rounded-xl px-4 py-2 text-white mb-4" placeholder="New Password"><button onclick="confirmResetPassword()" class="w-full bg-green-600 text-white py-2 rounded-xl font-bold mb-2">Confirm</button><div id="reset-result" class="text-center text-xs text-slate-300"></div></div><button onclick="closeForgotPass()" class="w-full bg-slate-700 text-white py-2 rounded-xl mt-2 text-sm">Cancel</button></div></div>
    
    <div id="credits-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/90 backdrop-blur-xl hidden animate-fade-in px-4">
        <div class="glass-panel p-8 rounded-3xl border border-pink-500/30 max-w-sm w-full relative shadow-[0_0_50px_rgba(236,72,153,0.3)]">
            <button onclick="closeCredits()" class="absolute top-4 right-4 text-slate-400 hover:text-white text-xl"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500 mb-6 text-center uppercase tracking-widest italic">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô</h2>
            <div class="space-y-4 text-center">
                <div class="bg-slate-900/60 p-4 rounded-xl border border-white/10 hover:border-pink-500/50 transition">
                    <div class="text-white font-bold text-lg">‡∏ô‡∏≤‡∏¢ ‡∏£‡∏±‡∏ä‡∏ä‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡∏Ñ‡∏≥‡∏ô‡∏≤‡∏î‡∏µ</div>
                    <div class="text-slate-400 text-sm">‡∏°.6/4 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 5</div>
                </div>
                <div class="bg-slate-900/60 p-4 rounded-xl border border-white/10 hover:border-pink-500/50 transition">
                    <div class="text-white font-bold text-lg">‡∏ô‡∏≤‡∏¢ ‡∏™‡∏£‡∏ß‡∏¥‡∏ä ‡∏ö‡∏∏‡∏ï‡∏£‡∏î‡∏µ</div>
                    <div class="text-slate-400 text-sm">‡∏°.6/4 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 11</div>
                </div>
                <div class="bg-slate-900/60 p-4 rounded-xl border border-white/10 hover:border-pink-500/50 transition">
                    <div class="text-white font-bold text-lg">‡∏ô‡∏≤‡∏¢ ‡∏ò‡πÄ‡∏ô‡∏® ‡πÄ‡∏Å‡∏ï‡∏∏‡∏´‡∏≠‡∏°</div>
                    <div class="text-slate-400 text-sm">‡∏°.6/4 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 17</div>
                </div>
                <div class="bg-slate-900/60 p-4 rounded-xl border border-white/10 hover:border-pink-500/50 transition">
                    <div class="text-white font-bold text-lg">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏ò‡∏ô‡∏±‡∏ä‡∏ä‡∏≤ ‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</div>
                    <div class="text-slate-400 text-sm">‡∏°.6/4 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 29</div>
                </div>
                <div class="bg-slate-900/60 p-4 rounded-xl border border-white/10 hover:border-pink-500/50 transition">
                    <div class="text-white font-bold text-lg">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏ò‡∏ô‡∏±‡∏ç‡∏ç‡∏≤ ‡∏™‡∏≠‡∏ô‡∏ô‡πâ‡∏≠‡∏¢</div>
                    <div class="text-slate-400 text-sm">‡∏°.6/4 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 35</div>
                </div>
            </div>
            <div class="mt-6 text-center text-[10px] text-slate-500">
                Created with passion for Astronomy & Code
            </div>
        </div>
    </div>

    <div id="question-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md hidden animate-fade-in px-4"><div class="glass-panel w-full max-w-md p-8 rounded-3xl border border-cyan-500/30 relative shadow-[0_0_60px_rgba(6,182,212,0.2)]"><div class="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-slate-900 p-4 rounded-full border-4 border-slate-700 shadow-xl"><div class="text-4xl">üß†</div></div><h3 class="text-center text-cyan-400 text-sm font-black mb-4 mt-4 uppercase tracking-[0.2em]">Data Verification</h3><h3 id="q-text" class="text-2xl font-bold text-white mb-8 text-center leading-relaxed font-sans">...</h3><div id="q-answers" class="flex flex-col gap-3"></div></div></div>
    <div id="dice-action-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden pointer-events-none"><div class="scene"><div class="cube" id="dice-cube"><div class="cube__face cube__face--1">1</div><div class="cube__face cube__face--2">2</div><div class="cube__face cube__face--3">3</div><div class="cube__face cube__face--4">4</div><div class="cube__face cube__face--5">5</div><div class="cube__face cube__face--6">6</div></div></div></div>
    
    <div id="rules-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/90 backdrop-blur-xl hidden animate-fade-in px-4">
        <div class="glass-panel p-8 rounded-3xl border border-red-500/30 max-w-md w-full relative max-h-[85vh] overflow-y-auto shadow-[0_0_50px_rgba(220,38,38,0.3)]">
            <button onclick="closeRules()" class="absolute top-4 right-4 text-slate-400 hover:text-white text-xl"><i class="fas fa-times"></i></button>
            <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500 mb-8 text-center uppercase tracking-widest italic transform -skew-x-6">‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å ‚ö†Ô∏è</h2>
            
            <div class="space-y-6 text-sm text-slate-300 font-light">
                <div><h3 class="font-bold text-cyan-400 text-lg mb-3 flex items-center gap-2 uppercase tracking-wide"><i class="fas fa-shield-alt"></i> ‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î</h3><div class="bg-slate-900/60 p-4 rounded-xl border-l-4 border-cyan-500 shadow-inner"><ul class="space-y-3"><li><span class="text-white font-bold">1. ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠‡∏£‡∏≠‡∏î:</span> ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î <span class="text-red-400 font-bold">-3 ‡∏ä‡πà‡∏≠‡∏á & -30 XP</span></li><li><span class="text-white font-bold">2. ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏´‡∏•‡∏∏‡∏°‡∏î‡∏≥ (‡∏á‡∏π):</span> ‡πÇ‡∏î‡∏ô‡∏î‡∏π‡∏î‡∏•‡∏á‡∏°‡∏≤ <span class="text-red-400 font-bold">-50 XP</span></li><li><span class="text-white font-bold">3. ‡∏´‡∏ô‡∏µ‡∏ó‡∏±‡∏û:</span> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏° <span class="text-red-500 font-black text-lg">-100 XP</span> ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!</li></ul></div></div>
                <div><h3 class="font-bold text-purple-400 text-lg mb-3 flex items-center gap-2 uppercase tracking-wide"><i class="fas fa-gem"></i> ‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤</h3><div class="bg-slate-900/60 p-4 rounded-xl border-l-4 border-purple-500 shadow-inner"><ul class="space-y-3"><li><span class="text-white font-bold">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡πà‡∏°:</span> ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå: ‡πÑ‡∏î‡πâ XP, ‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤, ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á</li><li><span class="text-white font-bold">üöÄ ‡∏ß‡∏≤‡∏£‡πå‡∏õ (‡∏ö‡∏±‡∏ô‡πÑ‡∏î):</span> ‡∏û‡∏∏‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ü‡∏£‡∏µ‡πÜ</li></ul></div></div>
                <div><h3 class="font-bold text-yellow-500 text-lg mb-3 flex items-center gap-2 uppercase tracking-wide"><i class="fas fa-crown"></i> ‡∏¢‡∏® (Ranking)</h3><div class="space-y-2 bg-slate-900/40 p-3 rounded-xl"><div class="flex justify-between items-center border-b border-white/5 pb-2"><span class="text-yellow-400 font-black text-sm">üëë LEGEND</span> <span class="font-mono text-white text-xs">3,000+</span></div><div class="flex justify-between items-center border-b border-white/5 pb-2"><span class="text-purple-400 font-bold text-sm">üåü GUARDIAN</span> <span class="font-mono text-white text-xs">1,500+</span></div><div class="flex justify-between items-center border-b border-white/5 pb-2"><span class="text-blue-400 font-bold text-sm">üë®‚ÄçüöÄ ASTRONAUT</span> <span class="font-mono text-white text-xs">800+</span></div><div class="flex justify-between items-center border-b border-white/5 pb-2"><span class="text-green-400 font-bold text-sm">üõ∏ TOURIST</span> <span class="font-mono text-white text-xs">500+</span></div><div class="flex justify-between items-center"><span class="text-slate-500 font-bold text-sm">üåë DUST</span> <span class="font-mono text-slate-600 text-xs">0+</span></div></div></div>
            </div>
            <button onclick="closeRules()" class="mt-8 w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white py-4 rounded-2xl font-black text-xl shadow-lg transform transition active:scale-95 tracking-[0.2em] uppercase border-t border-red-400">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö!</button>
        </div>
    </div>
    
    <div id="global-leaderboard-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-md hidden animate-fade-in px-4"><div class="glass-panel w-full max-w-md rounded-3xl border border-yellow-500/30 overflow-hidden flex flex-col max-h-[80vh] shadow-[0_0_100px_rgba(234,179,8,0.15)]"><div class="p-6 bg-slate-900/80 border-b border-slate-700 flex justify-between items-center"><h3 class="text-2xl font-black text-yellow-400 flex items-center gap-3 uppercase italic tracking-wider"><i class="fas fa-crown text-3xl"></i> Hall of Fame</h3><button onclick="closeGlobalLeaderboard()" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center hover:bg-slate-700 transition"><i class="fas fa-times"></i></button></div><div id="gl-list" class="p-4 overflow-y-auto no-scrollbar space-y-2 flex-1 bg-slate-900/40"></div></div></div>
    
    <div id="leaderboard-modal" class="fixed inset-0 z-[90] flex items-center justify-center bg-black/90 backdrop-blur-xl hidden animate-fade-in px-4"><div class="glass-panel p-10 rounded-[2rem] text-center max-w-sm w-full border border-yellow-500/50 shadow-[0_0_100px_rgba(234,179,8,0.4)] relative overflow-hidden"><div class="absolute inset-0 bg-yellow-500/10 blur-3xl"></div><div class="relative z-10"><div class="text-7xl mb-6 animate-bounce filter drop-shadow-lg">üèÜ</div><h2 id="result-title" class="text-4xl text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-orange-500 font-black mb-8 italic tracking-wider uppercase">MISSION ACCOMPLISHED</h2><div id="ranking-list" class="text-left mb-8 space-y-3"></div><div class="flex gap-4"><button id="reset-game-btn" onclick="resetGameHost()" class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 py-4 rounded-2xl font-bold text-white shadow-lg transition transform hover:scale-105">REPLAY</button><button onclick="leaveRoom()" class="flex-1 bg-slate-700 hover:bg-slate-600 py-4 rounded-2xl font-bold text-white shadow-lg transition">EXIT</button></div></div></div></div>

    <!-- Announcement Overlay (Injected) -->
    <div id="announcement-overlay" class="announce-overlay hidden"><div id="announcement-content" class="announce-box"></div></div>

</body>
</html>


